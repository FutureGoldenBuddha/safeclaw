# --- [ 1. Network Settings ] ---
# This fixes the "No forward-proxy ports configured" error
http_port 3128

# Match the username from your devcontainer.json
# Match the username from your docker-compose
cache_effective_user node

# --- [ 2. Disable Cache and PID ] ---
pid_filename none
cache deny all
# Removed cache_dir null /tmp because Alpine doesn't support the 'null' type
cache_mem 0 MB

# --- [ 3. Define Access Control Lists ] ---
# Use 'localnet' to define where your users are coming from
acl localnet src 192.168.1.0/24
acl localnet src 172.16.0.0/12  # Common Docker internal network range
acl localnet src 10.0.0.0/8     # Common internal range
acl localnet src 172.28.0.0/28 # rede interna openclaw_internal_secure

# Google-specific domains
acl google_domains dstdomain .google.com
acl google_domains dstdomain .gstatic.com
acl google_domains dstdomain .googleapis.com

# --- [ 4. Apply Rules ] ---
# 1. Allow Google access to local users
http_access allow google_domains localnet
# 2. Allow Google access to the container itself (localhost)
http_access allow google_domains localhost
# 3. Deny everything else
http_access deny all

# --- [ 5. Logging for Docker ] ---
access_log stdio:/dev/stdout
cache_log stdio:/dev/stderr
